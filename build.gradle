plugins {
    id 'application'
    id 'org.openjfx.javafxplugin' version '0.1.0'
    id 'org.beryx.runtime' version '1.13.1'
}

java {
    toolchain { languageVersion = JavaLanguageVersion.of(21) }
}

application {
    // Your JavaFX main class
    mainClass = 'app.MainApp'
    // JavaFX modules you need at runtime (no flags on the command line)
    applicationDefaultJvmArgs = ['--add-modules=javafx.controls,javafx.fxml',
                                 '-Duser.timezone=America/Bogota']
}

javafx {
    version = '21.0.3'
    modules = ['javafx.controls', 'javafx.fxml']
}

// Typical runtime deps (adjust versions to yours)
dependencies {
    implementation 'org.hibernate.orm:hibernate-core:6.5.2.Final'
    implementation 'jakarta.persistence:jakarta.persistence-api:3.1.0'
    implementation 'org.mariadb.jdbc:mariadb-java-client:3.3.3'
    // logging of your choice
    implementation 'ch.qos.logback:logback-classic:1.5.6'
}

def os = org.gradle.internal.os.OperatingSystem.current()

runtime {
    options = ['--strip-debug', '--compress', '2', '--no-header-files', '--no-man-pages']

    jpackage {
        appName = 'dStockUhf'
        vendor = 'YourCompany'
        appVersion = '0.1.0'

        // Pick sensible defaults per OS
        installerType = os.isWindows() ? 'exe' : (os.isMacOsX() ? 'dmg' : 'deb')
        // icons (put files under projectDir/packaging/)
        if (os.isWindows()) icon = "$projectDir/packaging/icon.ico"
        if (os.isMacOsX())  icon = "$projectDir/packaging/icon.icns"
        if (os.isLinux())   icon = "$projectDir/packaging/icon.png"

        // JVM args baked into the launcher
        jvmArgs = ['--add-modules=javafx.controls,javafx.fxml',
                   '-Duser.timezone=America/Bogota']

        // Optional: put a readme/license next to the installer
        // resourceDir = file("$projectDir/packaging")
    }
}
