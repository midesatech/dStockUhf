<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import java.net.URL?>
<?import javafx.geometry.Insets?>
<BorderPane fx:id="root" xmlns="http://javafx.com/javafx" xmlns:fx="http://javafx.com/fxml"
            fx:controller="infrastructure.fx.controller.dashboard.DashboardController">
    <top>
        <HBox spacing="10" styleClass="header" BorderPane.alignment="CENTER_LEFT">
            <Label text="Dashboard de Ocupación UHF" styleClass="title"/>
            <Label fx:id="subtitle" text="Cargando..." styleClass="subtitle"/>
        </HBox>
    </top>
    <center>
        <!-- SplitPane vertical: arriba KPIs (colapsable), abajo el contenido actual -->
        <SplitPane fx:id="splitMain" orientation="VERTICAL">
            <items>

                <!-- Panel superior: KPIs -->
                <AnchorPane fx:id="kpiContainer">
                    <children>
                        <HBox spacing="12" AnchorPane.topAnchor="8.0" AnchorPane.leftAnchor="16.0" AnchorPane.rightAnchor="120.0">
                            <VBox styleClass="kpi-card" alignment="CENTER_LEFT">
                                <Label text="Employees" styleClass="kpi-title"/>
                                <Label fx:id="lblTotalEmployees" text="0" styleClass="kpi-number"/>
                            </VBox>

                            <VBox styleClass="kpi-card" alignment="CENTER_LEFT">
                                <Label text="Equipment" styleClass="kpi-title"/>
                                <Label fx:id="lblTotalEquipment" text="0" styleClass="kpi-number"/>
                            </VBox>

                            <!-- NUEVOS KPIs: Presencia actual -->
                            <VBox styleClass="kpi-card accent" alignment="CENTER_LEFT">
                                <Label text="Presentes (Employees)" styleClass="kpi-title"/>
                                <Label fx:id="lblPresentEmployees" text="0" styleClass="kpi-number"/>
                            </VBox>

                            <VBox styleClass="kpi-card accent" alignment="CENTER_LEFT">
                                <Label text="Presentes (Equipment)" styleClass="kpi-title"/>
                                <Label fx:id="lblPresentEquipment" text="0" styleClass="kpi-number"/>
                            </VBox>
                        </HBox>

                        <!-- Botón para colapsar/expandir KPIs -->
                        <Button fx:id="btnToggleKpis" text="Ocultar KPIs"
                                onAction="#toggleKpis"
                                AnchorPane.topAnchor="8.0" AnchorPane.rightAnchor="16.0"
                                styleClass="kpi-toggle-btn"/>
                    </children>
                    <padding>
                        <Insets top="8" right="16" bottom="8" left="16"/>
                    </padding>
                    <minHeight>64.0</minHeight>
                </AnchorPane>

                <!-- Panel inferior: tu contenido existente -->
                <VBox spacing="10">
                    <ScrollPane fx:id="scroller" fitToWidth="true" VBox.vgrow="ALWAYS">
                        <content>
                            <FlowPane fx:id="tiles" hgap="16" vgap="16">
                                <padding><Insets top="10" right="10" bottom="10" left="10"/></padding>
                            </FlowPane>
                        </content>
                    </ScrollPane>


                    <!-- Zona de detalle -->
                    <TitledPane text="Detalle de ocupación" expanded="true">
                        <content>
                            <TableView fx:id="detailsTable" prefHeight="320.0">
                                <placeholder>
                                    <Label text="Selecciona una ubicación para ver los EPC detectados"/>
                                </placeholder>
                                <columns>
                                    <TableColumn fx:id="colTipo" text="Tipo" prefWidth="130"/>
                                    <TableColumn fx:id="colEpc" text="EPC" prefWidth="240"/>
                                    <TableColumn fx:id="colNombre" text="Nombre/Descripción" prefWidth="320"/>
                                    <TableColumn fx:id="colUltimo" text="Última detección" prefWidth="220"/>
                                </columns>
                            </TableView>
                        </content>
                    </TitledPane>
                </VBox>

            </items>
        </SplitPane>
    </center>

    <stylesheets>
        <URL value="@/infrastructure/fx/styles/dashboard.css"/>
    </stylesheets>
</BorderPane>